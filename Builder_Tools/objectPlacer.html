<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Builder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.3/pako.min.js"></script>
    <script src="../Jam_Engine/Graphics.js"></script>
    <script src="../Jam_Engine/Tools.js"></script>
    <script src="../Jam_Engine/UI/Button.js"></script>
    <script src="../Jam_Engine/Grid.js"></script>
    <script src="../Jam_Engine/AStar.js"></script>
</head>
<body>
    <canvas id="myCanvas" width="2816" height="1408"></canvas>

    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        const backBuffer = canvas.getContext('2d');
        ctx.imageSmoothingEnabled= false
        let objectList = {
            gems:[]
        }

        const saveAsJSON=()=>{
            const blob = new Blob([JSON.stringify(objectList, null, 4)], {type: "application/json"});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = "objects.json";
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);                        
        }
        const update=()=> {
            drawImageFrom00(backBuffer, images["Images/map1.png"],0,0,2816,1408);

            if(objectList?.gems) objectList.gems.forEach(gem=>drawCircle(backBuffer, gem.x,gem.y, 10,"Green"));

            // Schedule the next frame
            setTimeout(() => {
                requestAnimationFrame(update);
            }, 1000 / 10);  // 1000 ms / 10 FPS = 100 ms per frame
        }

        const finishedLoading = (loadedImages) => {
            images = loadedImages;
            update();
        }

        const getMouseInput=(event)=>{ 
            if(event.type === "down"){
                objectList.gems.push(event.position);                
            }
        }
        const getMouseMoveInput=(event)=>{}
        const getKeyboardInput=(event)=>{
            if(event.type == "down" && event.key == " "){
                saveAsJSON();
            }
        }

        let imagesToLoad = [
            "Images/map1.png"
        ];
        loadImages(imagesToLoad,finishedLoading);
    </script>
    <script src="../Jam_Engine/InputHandler.js"></script>
</body>
</html>
