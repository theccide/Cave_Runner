<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cave Runner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.3/pako.min.js"></script>
    <script src="Jam_Engine/Graphics.js"></script>
    <script src="Jam_Engine/Tools.js"></script>
    <script src="Jam_Engine/Grid.js"></script>
    <script src="Jam_Engine/AStar.js"></script>
    <script src="Entity.js"></script>
    <script src="Enemy.js"></script>
    <script src="Player.js"></script>
    <script src="LevelMap.js"></script>
    <script src="GameController.js"></script>
</head>
<body>
    <canvas id="myCanvas" width="500" height="500"></canvas>
    <button id="playButton"></button>

    <script>
        const canvas = document.getElementById('myCanvas');

        const WIDTH = 1888;
        const HEIGHT = 928;

        const SCREEN_HEIGHT = canvas.height;
        const SCREEN_WIDTH = canvas.width;

        const screenBuffer = canvas.getContext('2d');
        const backCanvas = createBufferedImage(WIDTH, HEIGHT);
        const backBuffer = backCanvas.getContext('2d');

        const gameController = new GameController();
        backBuffer.imageSmoothingEnabled= false
        screenBuffer.imageSmoothingEnabled= false

        // Store the timestamp of the previous frame
        let lastTimestamp = 0;

        // Game loop
        function update(deltaTime) {
            gameController.update(deltaTime);
        }

        function render() {
            //clear canvas
            backBuffer.clearRect(0, 0, WIDTH, HEIGHT);
            //add background
            backBuffer.fillStyle = 'black';
            backBuffer.fillRect(0, 0, WIDTH, HEIGHT);            
        }

        function gameLoop(timestamp) {
            // Calculate delta time
            const dt = (timestamp - lastTimestamp) / 1000; // Convert to seconds
            lastTimestamp = timestamp;

            // Update and render the game
            render();
            update(dt);

            drawImageSpriteFrom00(screenBuffer, backCanvas, 
                    0, 0, 250, 250,
                    0, 0, 500, 500
            ); 

            requestAnimationFrame(gameLoop);
        }

        gameController.start();

        const getMouseInput=(event)=>{ gameController.getMouseInput(event);}    
        const getMouseMoveInput=(event)=>{gameController.getMouseMoveInput(event);}
        const getKeyboardInput=(event)=>{gameController.getKeyboardInput(event);}
        
        // Start the game loop
        requestAnimationFrame(gameLoop);
    </script>
    <script src="Jam_Engine/InputHandler.js"></script>
</body>
</html>
