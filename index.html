<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Cave Runner</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.3/pako.min.js"></script>
    <script src="Jam_Engine/Graphics.js"></script>
    <script src="Jam_Engine/Tools.js"></script>
    <script src="Jam_Engine/UI/Button.js"></script>
    <script src="Jam_Engine/Grid.js"></script>
    <script src="Jam_Engine/AStar.js"></script>
    <script src="Jam_Engine/Scene.js"></script>    
    <script src="Entities/Entity.js"></script>
    <script src="Entities/MoveableEntity.js"></script>
    <script src="Entities/Bullet.js"></script>
    <script src="Entities/Enemy.js"></script>
    <script src="Entities/Gem.js"></script>
    <script src="Entities/Fx.js"></script>
    <script src="Entities/Torch.js"></script>
    <script src="Entities/MiniBoss.js"></script>
    <script src="Entities/Boss.js"></script>
    <script src="Entities/SpikeTrap.js"></script>
    <script src="Entities/Door.js"></script>
    <script src="Entities/LavaManager.js"></script>
    <script src="Player.js"></script>
    <script src="LevelMap.js"></script>
    <script src="Camera.js"></script>
    <script src="HUD.js"></script>
    <script src="GameController.js"></script>
    <script src="Scences/MainGame.js"></script>
    <script src="Scences/Logo.js"></script>
    <script src="Scences/Title.js"></script>
    <script src="Scences/GameOver.js"></script>
    <script src="Scences/LargeMap.js"></script>
    <script src="Jam_Engine/Sequencer.js"></script>

    <script src="Scences/Story.js"></script>
    <script src="storyGenerator.js"></script>

</head>
<body style="background-color: black;">
    <div class="parent-container"> -->
        <canvas id="myCanvas" width="0" height="0"></canvas>
    </div>
    <button id="playButton"></button> -->

    <script>
        const skipStory = false;
        const canvas = document.getElementById('myCanvas');
        // let copyScreenBuffer = screenBuffer = canvas.getContext('2d');
        let screenBuffer = canvas.getContext('2d');
        screenBuffer.canvas.width  = window.innerWidth;
        screenBuffer.canvas.height = window.innerHeight;        
        screenBuffer.imageSmoothingEnabled= false;

        let currentScene = null;
        let storyContent = "";
        let titleScreen = null;
        if(!skipStory){
            titleScreen = new Title();
            let storyGenerator = new StoryGenerator();
            storyGenerator.generateStory(titleScreen.readyCallback, titleScreen);       
            currentScene = new Logo();  
        }
        else {currentScene = new LargeMap();}
        // else {currentScene = new GameOver();}
        // let currentScene = new LargeMap();
        let lastTimestamp = 0; // Store the timestamp of the previous frame

        function changeScene (scene) {
            currentScene = scene;
        }

        let fpslastTime = 0;
        let frameCount = 0;
        let fps = 0;

        function drawFPS(){            
            const time = (new Date()).getTime();
            const deltaTime =  time - fpslastTime;            
            frameCount++;

            // Calculate FPS every 1000ms (1 second)
            if (deltaTime > 1000) {
                fps = frameCount;
                frameCount = 0;
                fpslastTime = time;
            }            
            // Draw the FPS
            screenBuffer.font = '24px Arial';
            screenBuffer.fillStyle = 'white';
            screenBuffer.fillText(`FPS: ${fps}`, 10, 30);            
        }

        function gameLoop(timestamp) {            
            const dt = (timestamp - lastTimestamp) / 1000; // Calculate delta time
            lastTimestamp = timestamp;            
            currentScene.update(dt); // Update and render the game  
            // drawFPS(timestamp);          
            requestAnimationFrame(gameLoop);
        }

        const getMouseInput=(event)=>{ currentScene.getMouseInput(event); }    
        const getMouseMoveInput=(event)=>{ currentScene.getMouseMoveInput(event); }
        const getKeyboardInput=(event)=>{ currentScene.getKeyboardInput(event); }
        
        requestAnimationFrame(gameLoop); // Start the game loop
    </script>
    <script src="Jam_Engine/InputHandler.js"></script>
</body>
</html>
